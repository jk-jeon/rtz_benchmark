# Benchmark for trailing zero removal

This repo is for benchmarking various trailing zero removal algorithms for their uses in [Dragonbox](https://github.com/jk-jeon/dragonbox).

Here is the benchmark result I got (on 04/20/2024, on Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz, Windows 10 Laptop):

- 32-bit benchmark for numbers with at most 8 digits.

| Algorithms                          | Average time consumed per a sample |
| ------------------------------------|------------------------------------|
| Naive                               | 13.3627ns                          |
| Granlund-Montgomery                 | 11.8732ns                          |
| Lemire                              | 12.5093ns                          |
| Generalized Granlund-Montgomery     | 12.1331ns                          |
| Naive 2-1                           | 9.11631ns                          |
| Granlund-Montgomery 2-1             | 8.28836ns                          |
| Lemire 2-1                          | 8.2219ns                           |
| Generalized Granlund-Montgomery 2-1 | 7.94078ns                          |

- 64-bit benchmark for numbers with at most 16 digits.

| Algorithms                            | Average time consumed per a sample |
| --------------------------------------|------------------------------------|
| Naive                                 | 15.6238ns                          |
| Granlund-Montgomery                   | 12.9074ns                          |
| Lemire                                | 13.7861ns                          |
| Generalized Granlund-Montgomery       | 14.3792ns                          |
| Naive 2-1                             | 14.4232ns                          |
| Granlund-Montgomery 2-1               | 10.8761ns                          |
| Lemire 2-1                            | 11.4825ns                          |
| Generalized Granlund-Montgomery 2-1   | 11.1745ns                          |
| Naive 8-2-1                           | 12.7571ns                          |
| Granlund-Montgomery 8-2-1             | 11.08ns                            |
| Lemire 8-2-1                          | 11.1306ns                          |
| Generalized Granlund-Montgomery 8-2-1 | 10.6098ns                          |

**Notes.**
- Samples are randomly generated by the following procedure:
  - Uniformly randomly generate the number of total digits, from 1 to the prescribed maximum number of digits.
  - Given the number of total digits, uniformly randomly generate the number of trailing zeros, from 0 to the number of total digits minus 1.
  - Given the number of total digits and the number of trailing zeros, uniformly randomly generate an unsigned integer.
- Algorithms without any suffix remove trailing zeros one by one.
- Algorithms with "2-1" suffix remove two consecutive trailing zeros first, and then remove one more zero if needed.
- Algorithms with "8-2-1" suffix first try to see if the input has at least eight trailing zeros, and if that is the case, then remove eight zeros and call the 32-bit "2-1" variants of themselves. If there are less than eight trailing zeros, then they proceed as their "2-1" variants.

# Building and installing

See the [BUILDING](BUILDING.md) document.

# Contributing

See the [CONTRIBUTING](CONTRIBUTING.md) document.

# Licensing

All code is licensed under Boost Software License Version 1.0 (LICENSE-Boost or https://www.boost.org/LICENSE_1_0.txt).
